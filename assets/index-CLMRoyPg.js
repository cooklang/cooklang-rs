(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();const V="/cooklang-rs/assets/cooklang_wasm_bg-qbT925dQ.wasm",Q=async(r={},e)=>{let t;if(e.startsWith("data:")){const n=e.replace(/^data:.*?base64,/,"");let s;if(typeof Buffer=="function"&&typeof Buffer.from=="function")s=Buffer.from(n,"base64");else if(typeof atob=="function"){const o=atob(n);s=new Uint8Array(o.length);for(let l=0;l<o.length;l++)s[l]=o.charCodeAt(l)}else throw new Error("Cannot decode base64-encoded data URL");t=await WebAssembly.instantiate(s,r)}else{const n=await fetch(e),s=n.headers.get("Content-Type")||"";if("instantiateStreaming"in WebAssembly&&s.startsWith("application/wasm"))t=await WebAssembly.instantiateStreaming(n,r);else{const o=await n.arrayBuffer();t=await WebAssembly.instantiate(o,r)}}return t.instance.exports};let i;function J(r){i=r}const K=typeof TextDecoder>"u"?(0,module.require)("util").TextDecoder:TextDecoder;let D=new K("utf-8",{ignoreBOM:!0,fatal:!0});D.decode();let S=null;function C(){return(S===null||S.byteLength===0)&&(S=new Uint8Array(i.memory.buffer)),S}function h(r,e){return r=r>>>0,D.decode(C().subarray(r,r+e))}function X(r){const e=i.__externref_table_alloc();return i.__wbindgen_export_2.set(e,r),e}function H(r,e){try{return r.apply(this,e)}catch(t){const n=X(t);i.__wbindgen_exn_store(n)}}let f=0;const Y=typeof TextEncoder>"u"?(0,module.require)("util").TextEncoder:TextEncoder;let M=new Y("utf-8");const Z=typeof M.encodeInto=="function"?function(r,e){return M.encodeInto(r,e)}:function(r,e){const t=M.encode(r);return e.set(t),{read:r.length,written:t.length}};function b(r,e,t){if(t===void 0){const p=M.encode(r),w=e(p.length,1)>>>0;return C().subarray(w,w+p.length).set(p),f=p.length,w}let n=r.length,s=e(n,1)>>>0;const o=C();let l=0;for(;l<n;l++){const p=r.charCodeAt(l);if(p>127)break;o[s+l]=p}if(l!==n){l!==0&&(r=r.slice(l)),s=t(s,n,n=l+r.length*3,1)>>>0;const p=C().subarray(s+l,s+n),w=Z(r,p);l+=w.written,s=t(s,n,l,1)>>>0}return f=l,s}function E(r){return r==null}let x=null;function A(){return(x===null||x.buffer.detached===!0||x.buffer.detached===void 0&&x.buffer!==i.memory.buffer)&&(x=new DataView(i.memory.buffer)),x}function ee(){let r,e;try{const t=i.version();return r=t[0],e=t[1],h(t[0],t[1])}finally{i.__wbindgen_free(r,e,1)}}function q(r,e){r=r>>>0;const t=A(),n=[];for(let s=r;s<r+4*e;s+=4)n.push(i.__wbindgen_export_2.get(t.getUint32(s,!0)));return i.__externref_drop_slice(r,e),n}function te(r){return i.ingredient_should_be_listed(r)!==0}function R(r){let e,t;try{const n=i.ingredient_display_name(r);return e=n[0],t=n[1],h(n[0],n[1])}finally{i.__wbindgen_free(e,t,1)}}function ne(r){return i.cookware_should_be_listed(r)!==0}function U(r){let e,t;try{const n=i.cookware_display_name(r);return e=n[0],t=n[1],h(n[0],n[1])}finally{i.__wbindgen_free(e,t,1)}}function O(r){return i.grouped_quantity_is_empty(r)!==0}function P(r){let e,t;try{const n=i.grouped_quantity_display(r);return e=n[0],t=n[1],h(n[0],n[1])}finally{i.__wbindgen_free(e,t,1)}}function T(r){let e,t;try{const n=i.quantity_display(r);return e=n[0],t=n[1],h(n[0],n[1])}finally{i.__wbindgen_free(e,t,1)}}const B=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(r=>i.__wbg_fallibleresult_free(r>>>0,1));class v{static __wrap(e){e=e>>>0;const t=Object.create(v.prototype);return t.__wbg_ptr=e,B.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,B.unregister(this),e}free(){const e=this.__destroy_into_raw();i.__wbg_fallibleresult_free(e,0)}get value(){let e,t;try{const n=i.__wbg_get_fallibleresult_value(this.__wbg_ptr);return e=n[0],t=n[1],h(n[0],n[1])}finally{i.__wbindgen_free(e,t,1)}}set value(e){const t=b(e,i.__wbindgen_malloc,i.__wbindgen_realloc),n=f;i.__wbg_set_fallibleresult_value(this.__wbg_ptr,t,n)}get error(){let e,t;try{const n=i.__wbg_get_fallibleresult_error(this.__wbg_ptr);return e=n[0],t=n[1],h(n[0],n[1])}finally{i.__wbindgen_free(e,t,1)}}set error(e){const t=b(e,i.__wbindgen_malloc,i.__wbindgen_realloc),n=f;i.__wbg_set_fallibleresult_error(this.__wbg_ptr,t,n)}}const j=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(r=>i.__wbg_parser_free(r>>>0,1));class F{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,j.unregister(this),e}free(){const e=this.__destroy_into_raw();i.__wbg_parser_free(e,0)}constructor(){const e=i.parser_new();return this.__wbg_ptr=e>>>0,j.register(this,this.__wbg_ptr,this),this}get load_units(){return i.parser_load_units(this.__wbg_ptr)!==0}set load_units(e){i.parser_set_load_units(this.__wbg_ptr,e)}get extensions(){return i.parser_extensions(this.__wbg_ptr)>>>0}set extensions(e){i.parser_set_extensions(this.__wbg_ptr,e)}parse_events(e){let t,n;try{const s=b(e,i.__wbindgen_malloc,i.__wbindgen_realloc),o=f,l=i.parser_parse_events(this.__wbg_ptr,s,o);return t=l[0],n=l[1],h(l[0],l[1])}finally{i.__wbindgen_free(t,n,1)}}parse_ast(e,t){const n=b(e,i.__wbindgen_malloc,i.__wbindgen_realloc),s=f,o=i.parser_parse_ast(this.__wbg_ptr,n,s,t);return v.__wrap(o)}parse(e,t){const n=b(e,i.__wbindgen_malloc,i.__wbindgen_realloc),s=f;return i.parser_parse(this.__wbg_ptr,n,s,!E(t),E(t)?0:t)}group_ingredients(e){const t=i.parser_group_ingredients(this.__wbg_ptr,e);var n=q(t[0],t[1]).slice();return i.__wbindgen_free(t[0],t[1]*4,4),n}group_cookware(e){const t=i.parser_group_cookware(this.__wbg_ptr,e);var n=q(t[0],t[1]).slice();return i.__wbindgen_free(t[0],t[1]*4,4),n}parse_full(e,t){const n=b(e,i.__wbindgen_malloc,i.__wbindgen_realloc),s=f,o=i.parser_parse_full(this.__wbg_ptr,n,s,t);return v.__wrap(o)}parse_render(e,t){const n=b(e,i.__wbindgen_malloc,i.__wbindgen_realloc),s=f,o=i.parser_parse_render(this.__wbg_ptr,n,s,!E(t),E(t)?0:t);return v.__wrap(o)}std_metadata(e){const t=b(e,i.__wbindgen_malloc,i.__wbindgen_realloc),n=f,s=i.parser_std_metadata(this.__wbg_ptr,t,n);return v.__wrap(s)}}function re(){return H(function(r,e){return JSON.parse(h(r,e))},arguments)}function se(){return H(function(r){return JSON.stringify(r)},arguments)}function ie(){const r=i.__wbindgen_export_2,e=r.grow(4);r.set(0,void 0),r.set(e+0,void 0),r.set(e+1,null),r.set(e+2,!0),r.set(e+3,!1)}function oe(r){return r===void 0}function ae(r,e){const t=e,n=typeof t=="string"?t:void 0;var s=E(n)?0:b(n,i.__wbindgen_malloc,i.__wbindgen_realloc),o=f;A().setInt32(r+4*1,o,!0),A().setInt32(r+4*0,s,!0)}function _e(r,e){throw new Error(h(r,e))}URL=globalThis.URL;const a=await Q({"./cooklang_wasm_bg.js":{__wbindgen_is_undefined:oe,__wbindgen_string_get:ae,__wbg_parse_def2e24ef1252aff:re,__wbg_stringify_f7ed6987935b4a24:se,__wbindgen_throw:_e,__wbindgen_init_externref_table:ie}},V),le=a.memory,ce=a.version,de=a.__wbg_parser_free,ue=a.parser_new,pe=a.parser_load_units,ge=a.parser_set_load_units,fe=a.parser_extensions,he=a.parser_set_extensions,be=a.parser_parse_events,we=a.parser_parse_ast,me=a.parser_parse,ye=a.parser_group_ingredients,xe=a.parser_group_cookware,ve=a.parser_parse_full,ke=a.parser_parse_render,Ie=a.parser_std_metadata,Ee=a.__wbg_fallibleresult_free,Se=a.__wbg_get_fallibleresult_value,Te=a.__wbg_set_fallibleresult_value,Ce=a.__wbg_get_fallibleresult_error,Me=a.__wbg_set_fallibleresult_error,Le=a.ingredient_should_be_listed,Ae=a.ingredient_display_name,$e=a.cookware_should_be_listed,Ne=a.cookware_display_name,qe=a.grouped_quantity_is_empty,Re=a.grouped_quantity_display,Ue=a.quantity_display,Oe=a.__wbindgen_exn_store,Pe=a.__externref_table_alloc,Be=a.__wbindgen_export_2,je=a.__wbindgen_malloc,De=a.__wbindgen_realloc,He=a.__wbindgen_free,Fe=a.__externref_drop_slice,G=a.__wbindgen_start,Ge=Object.freeze(Object.defineProperty({__proto__:null,__externref_drop_slice:Fe,__externref_table_alloc:Pe,__wbg_fallibleresult_free:Ee,__wbg_get_fallibleresult_error:Ce,__wbg_get_fallibleresult_value:Se,__wbg_parser_free:de,__wbg_set_fallibleresult_error:Me,__wbg_set_fallibleresult_value:Te,__wbindgen_exn_store:Oe,__wbindgen_export_2:Be,__wbindgen_free:He,__wbindgen_malloc:je,__wbindgen_realloc:De,__wbindgen_start:G,cookware_display_name:Ne,cookware_should_be_listed:$e,grouped_quantity_display:Re,grouped_quantity_is_empty:qe,ingredient_display_name:Ae,ingredient_should_be_listed:Le,memory:le,parser_extensions:fe,parser_group_cookware:xe,parser_group_ingredients:ye,parser_load_units:pe,parser_new:ue,parser_parse:me,parser_parse_ast:we,parser_parse_events:be,parser_parse_full:ve,parser_parse_render:ke,parser_set_extensions:he,parser_set_load_units:ge,parser_std_metadata:Ie,quantity_display:Ue,version:ce},Symbol.toStringTag,{value:"Module"}));J(Ge);G();class We{constructor(e,t,n){this.title=e.metadata.title,this.description=e.metadata.description,this.tags=new Set(e.metadata.tags),this.author=e.metadata.author,this.source=e.metadata.source,this.course=e.metadata.course,this.time=e.metadata.time,this.servings=e.metadata.servings,this.difficulty=e.metadata.difficulty,this.cuisine=e.metadata.cuisine,this.diet=e.metadata.diet,this.images=e.metadata.images,this.locale=e.metadata.locale,this.custom_metadata=new Map;for(let s in e.metadata.custom)this.custom_metadata.set(s,e.metadata.custom[s]);this.rawMetadata=new Map;for(let s in e.recipe.raw_metadata.map)this.rawMetadata.set(s,e.recipe.raw_metadata.map[s]);this.sections=e.recipe.sections,this.ingredients=e.recipe.ingredients,this.cookware=e.recipe.cookware,this.timers=e.recipe.timers,this.inlineQuantities=e.recipe.inline_quantities,this.groupedIngredients=t.map(s=>[this.ingredients[s.index],s.quantity]),this.groupedCookware=n.map(s=>[this.cookware[s.index],s.quantity])}}class ze{constructor(){this.parser=new F}parse(e,t){let n=this.parser.parse(e,t);return[new We(n,this.parser.group_ingredients(n),this.parser.group_cookware(n)),n.report]}set units(e){this.parser.load_units=e}get units(){return this.parser.load_units}set extensions(e){this.parser.extensions=e}get extensions(){return this.parser.extensions}}class Ve{render(e){this.result="",this.recipe=e;const t=e.groupedIngredients,n=e.groupedCookware;return this.renderMetadata(e.rawMetadata),this.renderGroupedIngredients(t),this.renderGroupedCookwares(n),(n.length>0||t.length>0)&&(this.result+="<hr>"),this.renderSections(e.sections),this.result}renderMetadata(e){if(e.size>0){this.result+="<ul>";for(const[t,n]of e)this.renderMetadatum(t,n);this.result+="</ul>",this.result+="<hr>"}}renderMetadatum(e,t){this.result+="<li class='metadata'>",this.result+=`<span class='key'>${e}</span>: <span class='value'>${t}</span>`,this.result+="</li>"}renderGroupedIngredients(e){if(e.length>0){this.result+="<h2>Ingredients:</h2>",this.result+="<ul>";for(const[t,n]of e)this.renderGroupedIngredientHelper(t,n);this.result+="</ul>"}}renderGroupedIngredientHelper(e,t){if(te(e)){const n=R(e),s=O(t)?null:P(t);this.renderGroupedIngredient(n,s,e.note)}}renderGroupedIngredient(e,t,n){this.result+="<li>",this.result+=`<b>${e}</b>`,t&&(this.result+=`: ${t}`),n&&(this.result+=` (${n})`),this.result+="</li>"}renderGroupedCookwares(e){if(e.length>0){this.result+="<h2>Cookware:</h2>",this.result+="<ul>";for(const[t,n]of e)this.renderGroupedCookwareHelper(t,n);this.result+="</ul>"}}renderGroupedCookwareHelper(e,t){if(ne(e)){const n=U(e),s=O(t)?null:P(t);this.renderGroupedCookware(n,s,e.note)}}renderGroupedCookware(e,t,n){this.result+="<li>",this.result+=`<b>${e}</b>`,t&&(this.result+=`: ${t}`),n&&(this.result+=` (${n})`),this.result+="</li>"}renderSections(e){for(let t=0;t<e.length;t++){const n=e[t],s=t+1;n.name?this.result+=`<h3>(${s}) ${n.name}</h3>`:e.length>1&&(this.result+=`<h3>Section ${s}</h3>`);for(const o of n.content)this.renderContent(n,o)}}renderContent(e,t){switch(t.type){case"text":this.result+=`<p>${t.value}</p>>`;break;case"step":this.renderStep(e,t.value);break}}renderStep(e,t){this.result+=`<p><b>${t.number}. </b>`;for(const n of t.items)switch(n.type){case"text":this.result+=n.value;break;case"ingredient":this.renderInlineIngredient(e,this.recipe.ingredients[n.index]);break;case"timer":this.renderInlineTimer(this.recipe.timers[n.index]);break;case"inlineQuantity":this.renderInlineQuantity(this.recipe.inlineQuantities[n.index]);break;case"cookware":this.renderInlineCookware(this.recipe.cookware[n.index]);break}this.result+="</p>"}renderInlineIngredient(e,t){if(this.result+="<span class='ingredient'>",this.result+=R(t),t.quantity&&(this.result+=`<i>(${T(t.quantity)})</i>`),t.relation.relation.type==="reference"){const n=t.relation.relation.references_to;switch(t.relation.reference_target){case"ingredient":break;case"step":e.content[n].type==="step"&&`${e.content[n].value.number}`;break}}this.result+="</span>"}renderInlineTimer(e){this.result+="<span class='timer'>",e.name&&(this.result+=`(${e.name})`),e.quantity&&(this.result+=`<i>${T(e.quantity)}</i>`),this.result+="</span>"}renderInlineQuantity(e){this.result+=`<i class="temp">(${T(e)})</i>`}renderInlineCookware(e){this.result+="<span class='cookware'>",this.result+=U(e),e.quantity&&(this.result+=`<i>(${T(e.quantity)})</i>`),this.result+="</span>"}}async function Qe(){const r=window.ace.edit("editor",{wrap:!0,printMargin:!1,fontSize:16,fontFamily:"Jetbrains Mono",placeholder:"Write your recipe here"}),e=window.sessionStorage.getItem("input")??"Write your @recipe here!";r.setValue(e);const t=document.getElementById("output"),n=document.getElementById("errors"),s=document.getElementById("errors-details"),o=document.getElementById("parserSelect"),l=document.getElementById("json"),p=document.getElementById("servings"),w=document.getElementById("loadUnits"),$=document.getElementById("version");$&&($.textContent=ee());const g=new F,k=new ze,m=new URLSearchParams(window.location.search);if(m.has("json")&&(l.checked=m.get("json")==="true"),m.has("loadUnits")){const _=m.get("loadUnits")==="true";g.load_units=_,k.units=_}w.checked=g.load_units,m.has("extensions")&&(g.extensions=Number(m.get("extensions")),k.extensions=Number(m.get("extensions")));let L=m.get("mode")||localStorage.getItem("mode");L!==null&&(o.value=L,N(L));function y(){const _=r.getValue();window.sessionStorage.setItem("input",_);const d=g.parse(_);switch(console.log({test:d,s:JSON.stringify(d,null,2)}),o.value){case"full":{const{value:c,error:u}=g.parse_full(_,l.checked);t.textContent=c,n.innerHTML=u;break}case"events":{const c=g.parse_events(_);t.textContent=c,n.innerHTML="";break}case"ast":{const{value:c,error:u}=g.parse_ast(_,l.checked);t.textContent=c,n.innerHTML=u;break}case"render":{const{value:c,error:u}=g.parse_render(_,p.value.length===0?null:p.valueAsNumber);t.innerHTML=c,n.innerHTML=u;break}case"stdmeta":{const{value:c,error:u}=g.std_metadata(_);t.innerHTML=c,n.innerHTML=u;break}case"render2":{const[c,u]=k.parse(_,p.value.length===0?null:p.valueAsNumber),I=new Ve;t.innerHTML=I.render(c),n.innerHTML=u;break}}s.open=n.childElementCount!==0}r.on("change",Je(y,100)),o.addEventListener("change",_=>N(_.target.value)),l.addEventListener("change",_=>{const d=new URLSearchParams(window.location.search);_.target.checked?d.set("json","true"):d.delete("json"),window.history.replaceState(null,"",window.location.pathname+"?"+d.toString()),y()}),w.addEventListener("change",_=>{const d=new URLSearchParams(window.location.search),c=_.target;g.load_units=!!c.checked,k.units=!!c.checked,c.checked?d.delete("loadUnits"):d.set("loadUnits","false"),window.history.replaceState(null,"",window.location.pathname+"?"+d.toString()),y()}),p.addEventListener("change",()=>y());const W=document.getElementById("extensions-container");[["COMPONENT_MODIFIERS",2],["COMPONENT_ALIAS",8],["ADVANCED_UNITS",32],["MODES",64],["INLINE_QUANTITIES",128],["RANGE_VALUES",512],["TIMER_REQUIRES_TIME",1024],["INTERMEDIATE_PREPARATIONS",2050]].forEach(([_,d])=>{const c=document.createElement("input");c.setAttribute("type","checkbox"),c.setAttribute("id",_),c.setAttribute("data-ext-bits",d.toString()),c.checked=(g.extensions&d)===d;const u=document.createElement("label");u.setAttribute("for",_),u.textContent=_;const I=document.createElement("div");I.appendChild(c),I.appendChild(u),W.appendChild(I),c.addEventListener("change",z)});function z(){let _=0;document.querySelectorAll("[data-ext-bits]:checked").forEach(c=>{const u=Number(c.getAttribute("data-ext-bits"));_|=u}),console.log(_),g.extensions=_,k.extensions=_;const d=new URLSearchParams(window.location.search);d.set("extensions",_.toString()),window.history.replaceState(null,"",window.location.pathname+"?"+d.toString()),y()}function N(_){const d=new URLSearchParams(window.location.search);d.set("mode",_),window.history.replaceState(null,"",window.location.pathname+"?"+d.toString());const c=document.getElementById("jsoncontainer"),u=document.getElementById("servingscontainer");c.hidden=_==="render"||_==="render2"||_==="events",u.hidden=_!=="render"&&_!=="render2",localStorage.setItem("mode",_),y()}r.focus(),y()}function Je(r,e){let t=null,n=!0;return()=>{n?(r(),n=!1):(t!==null&&clearTimeout(t),t=setTimeout(r,e))}}Qe();
