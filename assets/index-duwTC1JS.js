(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const _ of o)if(_.type==="childList")for(const a of _.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(o){const _={};return o.integrity&&(_.integrity=o.integrity),o.referrerPolicy&&(_.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?_.credentials="include":o.crossOrigin==="anonymous"?_.credentials="omit":_.credentials="same-origin",_}function r(o){if(o.ep)return;o.ep=!0;const _=t(o);fetch(o.href,_)}})();const P="/assets/cooklang_wasm_bg-smWt55sf.wasm",k=async(n={},e)=>{let t;if(e.startsWith("data:")){const r=e.replace(/^data:.*?base64,/,"");let o;if(typeof Buffer=="function"&&typeof Buffer.from=="function")o=Buffer.from(r,"base64");else if(typeof atob=="function"){const _=atob(r);o=new Uint8Array(_.length);for(let a=0;a<_.length;a++)o[a]=_.charCodeAt(a)}else throw new Error("Cannot decode base64-encoded data URL");t=await WebAssembly.instantiate(o,n)}else{const r=await fetch(e),o=r.headers.get("Content-Type")||"";if("instantiateStreaming"in WebAssembly&&o.startsWith("application/wasm"))t=await WebAssembly.instantiateStreaming(r,n);else{const _=await r.arrayBuffer();t=await WebAssembly.instantiate(_,n)}}return t.instance.exports};let s;function j(n){s=n}const W=typeof TextDecoder>"u"?(0,module.require)("util").TextDecoder:TextDecoder;let N=new W("utf-8",{ignoreBOM:!0,fatal:!0});N.decode();let E=null;function v(){return(E===null||E.byteLength===0)&&(E=new Uint8Array(s.memory.buffer)),E}function x(n,e){return n=n>>>0,N.decode(v().subarray(n,n+e))}function F(n){const e=s.__externref_table_alloc();return s.__wbindgen_export_2.set(e,n),e}function D(n,e){try{return n.apply(this,e)}catch(t){const r=F(t);s.__wbindgen_exn_store(r)}}function z(){let n,e;try{const t=s.version();return n=t[0],e=t[1],x(t[0],t[1])}finally{s.__wbindgen_free(n,e,1)}}let p=0;const H=typeof TextEncoder>"u"?(0,module.require)("util").TextEncoder:TextEncoder;let S=new H("utf-8");const V=typeof S.encodeInto=="function"?function(n,e){return S.encodeInto(n,e)}:function(n,e){const t=S.encode(n);return e.set(t),{read:n.length,written:t.length}};function b(n,e,t){if(t===void 0){const f=S.encode(n),w=e(f.length,1)>>>0;return v().subarray(w,w+f.length).set(f),p=f.length,w}let r=n.length,o=e(r,1)>>>0;const _=v();let a=0;for(;a<r;a++){const f=n.charCodeAt(a);if(f>127)break;_[o+a]=f}if(a!==r){a!==0&&(n=n.slice(a)),o=t(o,r,r=a+n.length*3,1)>>>0;const f=v().subarray(o+a,o+r),w=V(n,f);a+=w.written,o=t(o,r,a,1)>>>0}return p=a,o}function M(n){return n==null}const U=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>s.__wbg_fallibleresult_free(n>>>0,1));class y{static __wrap(e){e=e>>>0;const t=Object.create(y.prototype);return t.__wbg_ptr=e,U.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,U.unregister(this),e}free(){const e=this.__destroy_into_raw();s.__wbg_fallibleresult_free(e,0)}get value(){let e,t;try{const r=s.__wbg_get_fallibleresult_value(this.__wbg_ptr);return e=r[0],t=r[1],x(r[0],r[1])}finally{s.__wbindgen_free(e,t,1)}}set value(e){const t=b(e,s.__wbindgen_malloc,s.__wbindgen_realloc),r=p;s.__wbg_set_fallibleresult_value(this.__wbg_ptr,t,r)}get error(){let e,t;try{const r=s.__wbg_get_fallibleresult_error(this.__wbg_ptr);return e=r[0],t=r[1],x(r[0],r[1])}finally{s.__wbindgen_free(e,t,1)}}set error(e){const t=b(e,s.__wbindgen_malloc,s.__wbindgen_realloc),r=p;s.__wbg_set_fallibleresult_error(this.__wbg_ptr,t,r)}}const C=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>s.__wbg_parser_free(n>>>0,1));class q{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,C.unregister(this),e}free(){const e=this.__destroy_into_raw();s.__wbg_parser_free(e,0)}constructor(){const e=s.parser_new();return this.__wbg_ptr=e>>>0,C.register(this,this.__wbg_ptr,this),this}get load_units(){return s.parser_load_units(this.__wbg_ptr)!==0}set load_units(e){s.parser_set_load_units(this.__wbg_ptr,e)}get extensions(){return s.parser_extensions(this.__wbg_ptr)>>>0}set extensions(e){s.parser_set_extensions(this.__wbg_ptr,e)}parse_events(e){let t,r;try{const o=b(e,s.__wbindgen_malloc,s.__wbindgen_realloc),_=p,a=s.parser_parse_events(this.__wbg_ptr,o,_);return t=a[0],r=a[1],x(a[0],a[1])}finally{s.__wbindgen_free(t,r,1)}}parse_ast(e,t){const r=b(e,s.__wbindgen_malloc,s.__wbindgen_realloc),o=p,_=s.parser_parse_ast(this.__wbg_ptr,r,o,t);return y.__wrap(_)}parse(e){const t=b(e,s.__wbindgen_malloc,s.__wbindgen_realloc),r=p;return s.parser_parse(this.__wbg_ptr,t,r)}parse_full(e,t){const r=b(e,s.__wbindgen_malloc,s.__wbindgen_realloc),o=p,_=s.parser_parse_full(this.__wbg_ptr,r,o,t);return y.__wrap(_)}parse_render(e,t){const r=b(e,s.__wbindgen_malloc,s.__wbindgen_realloc),o=p,_=s.parser_parse_render(this.__wbg_ptr,r,o,!M(t),M(t)?0:t);return y.__wrap(_)}std_metadata(e){const t=b(e,s.__wbindgen_malloc,s.__wbindgen_realloc),r=p,o=s.parser_std_metadata(this.__wbg_ptr,t,r);return y.__wrap(o)}}function J(){return D(function(n,e){return JSON.parse(x(n,e))},arguments)}function Q(){const n=s.__wbindgen_export_2,e=n.grow(4);n.set(0,void 0),n.set(e+0,void 0),n.set(e+1,null),n.set(e+2,!0),n.set(e+3,!1)}function $(n,e){throw new Error(x(n,e))}URL=globalThis.URL;const l=await k({"./cooklang_wasm_bg.js":{__wbg_parse_def2e24ef1252aff:J,__wbindgen_throw:$,__wbindgen_init_externref_table:Q}},P),G=l.memory,K=l.version,X=l.__wbg_parser_free,Y=l.parser_new,Z=l.parser_load_units,ee=l.parser_set_load_units,te=l.parser_extensions,ne=l.parser_set_extensions,re=l.parser_parse_events,se=l.parser_parse_ast,oe=l.parser_parse,_e=l.parser_parse_full,ae=l.parser_parse_render,ie=l.parser_std_metadata,le=l.__wbg_fallibleresult_free,ce=l.__wbg_get_fallibleresult_value,de=l.__wbg_set_fallibleresult_value,ue=l.__wbg_get_fallibleresult_error,fe=l.__wbg_set_fallibleresult_error,ge=l.__wbindgen_exn_store,pe=l.__externref_table_alloc,we=l.__wbindgen_export_2,be=l.__wbindgen_free,me=l.__wbindgen_malloc,he=l.__wbindgen_realloc,R=l.__wbindgen_start,ye=Object.freeze(Object.defineProperty({__proto__:null,__externref_table_alloc:pe,__wbg_fallibleresult_free:le,__wbg_get_fallibleresult_error:ue,__wbg_get_fallibleresult_value:ce,__wbg_parser_free:X,__wbg_set_fallibleresult_error:fe,__wbg_set_fallibleresult_value:de,__wbindgen_exn_store:ge,__wbindgen_export_2:we,__wbindgen_free:be,__wbindgen_malloc:me,__wbindgen_realloc:he,__wbindgen_start:R,memory:G,parser_extensions:te,parser_load_units:Z,parser_new:Y,parser_parse:oe,parser_parse_ast:se,parser_parse_events:re,parser_parse_full:_e,parser_parse_render:ae,parser_set_extensions:ne,parser_set_load_units:ee,parser_std_metadata:ie,version:K},Symbol.toStringTag,{value:"Module"}));j(ye);R();async function xe(){const n=window.ace.edit("editor",{wrap:!0,printMargin:!1,fontSize:16,fontFamily:"Jetbrains Mono",placeholder:"Write your recipe here"}),e=window.sessionStorage.getItem("input")??"Write your @recipe here!";n.setValue(e);const t=document.getElementById("output"),r=document.getElementById("errors"),o=document.getElementById("errors-details"),_=document.getElementById("parserSelect"),a=document.getElementById("json"),f=document.getElementById("servings"),w=document.getElementById("loadUnits"),L=document.getElementById("version");L&&(L.textContent=z());const g=new q,m=new URLSearchParams(window.location.search);if(m.has("json")&&(a.checked=m.get("json")==="true"),m.has("loadUnits")){const i=m.get("loadUnits")==="true";g.load_units=i}w.checked=g.load_units,m.has("extensions")&&(g.extensions=Number(m.get("extensions")));let T=m.get("mode")||localStorage.getItem("mode");T!==null&&(_.value=T,A(T));function h(){const i=n.getValue();window.sessionStorage.setItem("input",i);const d=g.parse(i);switch(console.log({test:d,s:JSON.stringify(d,null,2)}),_.value){case"full":{const{value:c,error:u}=g.parse_full(i,a.checked);t.textContent=c,r.innerHTML=u;break}case"events":{const c=g.parse_events(i);t.textContent=c,r.innerHTML="";break}case"ast":{const{value:c,error:u}=g.parse_ast(i,a.checked);t.textContent=c,r.innerHTML=u;break}case"render":{const{value:c,error:u}=g.parse_render(i,f.value.length===0?null:f.valueAsNumber);t.innerHTML=c,r.innerHTML=u;break}case"stdmeta":{const{value:c,error:u}=g.std_metadata(i);t.innerHTML=c,r.innerHTML=u;break}}o.open=r.childElementCount!==0}n.on("change",Ee(h,100)),_.addEventListener("change",i=>A(i.target.value)),a.addEventListener("change",i=>{const d=new URLSearchParams(window.location.search);i.target.checked?d.set("json","true"):d.delete("json"),window.history.replaceState(null,"",window.location.pathname+"?"+d.toString()),h()}),w.addEventListener("change",i=>{const d=new URLSearchParams(window.location.search),c=i.target;g.load_units=!!c.checked,c.checked?d.delete("loadUnits"):d.set("loadUnits","false"),window.history.replaceState(null,"",window.location.pathname+"?"+d.toString()),h()}),f.addEventListener("change",()=>h());const O=document.getElementById("extensions-container");[["COMPONENT_MODIFIERS",2],["COMPONENT_ALIAS",8],["ADVANCED_UNITS",32],["MODES",64],["INLINE_QUANTITIES",128],["RANGE_VALUES",512],["TIMER_REQUIRES_TIME",1024],["INTERMEDIATE_PREPARATIONS",2050]].forEach(([i,d])=>{const c=document.createElement("input");c.setAttribute("type","checkbox"),c.setAttribute("id",i),c.setAttribute("data-ext-bits",d.toString()),c.checked=(g.extensions&d)===d;const u=document.createElement("label");u.setAttribute("for",i),u.textContent=i;const I=document.createElement("div");I.appendChild(c),I.appendChild(u),O.appendChild(I),c.addEventListener("change",B)});function B(){let i=0;document.querySelectorAll("[data-ext-bits]:checked").forEach(c=>{const u=Number(c.getAttribute("data-ext-bits"));i|=u}),console.log(i),g.extensions=i;const d=new URLSearchParams(window.location.search);d.set("extensions",i.toString()),window.history.replaceState(null,"",window.location.pathname+"?"+d.toString()),h()}function A(i){const d=new URLSearchParams(window.location.search);d.set("mode",i),window.history.replaceState(null,"",window.location.pathname+"?"+d.toString());const c=document.getElementById("jsoncontainer"),u=document.getElementById("servingscontainer");c.hidden=i==="render"||i==="events",u.hidden=i!=="render",localStorage.setItem("mode",i),h()}n.focus(),h()}function Ee(n,e){let t=null,r=!0;return()=>{r?(n(),r=!1):(t!==null&&clearTimeout(t),t=setTimeout(n,e))}}xe();
